<!DOCTYPE html>
<html lang="en">
<head>…</head>
<body>
  <div id="game-root"></div>
  <script>
  (async function(){
    // 1) parse URL parameters
    function getParam(name) {
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }
    const forcedUid    = getParam('uid');      // optional override
    const forcedCard  = getParam('cardId');   // optional override

    // 2) Firebase init
    firebase.initializeApp({ /* your config */ });
    const auth = firebase.auth(), db = firebase.database();

    // 3) determine UID
    let uid = forcedUid || null;
    if (!uid) {
      await new Promise(r=>
        auth.onAuthStateChanged(u=>u?(uid=u.uid,r()):auth.signInAnonymously().then(c=>{uid=c.user.uid;r()}))
      );
    }

    // 4) inline card metadata
    const cardMeta = {
      "vito_the_intimidator": { faction:"enforcers" },
      "lola_the_quick":       { faction:"undercutters" },
      "bruno_the_tank":       { faction:"syndicate" }
      // …add more
    };

    // 5) fetch or seed player
    let player = await db.ref(`/players/${uid}`).once('value').then(s=>s.val());
    if (!player) {
      // choose card: forcedCard > random
      const cardId = forcedCard && cardMeta[forcedCard]
                     ? forcedCard
                     : Object.keys(cardMeta)[Math.floor(Math.random()*Object.keys(cardMeta).length)];
      player = {
        cardId,
        faction: cardMeta[cardId].faction,
        weapons: ["tommy-gun","bulletproof_vest"],
        stats: { health:100, energy:50, experience:0 },
        abilities: { quick_shot:{ attackBonus:5, cooldown:30 } },
        lastUpdated: new Date().toISOString()
      };
      await db.ref(`/players/${uid}`).set(player);
    }

    // 6) fetch definitions & render (same as before) …
    //   fetchWeapon, fetchFaction, renderCard logic remains identical,
    //   except it always uses our computed `player`.

    await renderCard('game-root', player);
  })();
  </script>
</body>
</html>

